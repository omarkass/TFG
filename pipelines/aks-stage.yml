trigger: none

parameters:
- name: azureSubscription
  type: string
  default: 'Azure subscription 1(2c02e9f9-7fad-4208-82e1-4e97500b5e0e)'

- name: acrName
  type: string 
  default: 'projcr22er'
  
- name: aksclusterName
  type: string 
  default: 'aks'
  
- name: acrUrl
  type: string
  default: 'projcr22er.azurecr.io' 

- name: resourceGroupName
  type: string 
  default: 'proj-dev-app-rg'

stages:

- stage: Build
  #vmImageName: 'ubuntu-latest'
  displayName: Build and push stage
  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
      - task: DockerInstaller@0
        inputs:
          dockerVersion: '17.09.0-ce'
      - task: AzureCLI@2
        inputs:
          azureSubscription: ${{ parameters.azureSubscription }} 
          scriptType: 'bash'
          scriptLocation: 'inlineScript'
          inlineScript: |
            docker build ./content/aks-content -t python
            az aks get-credentials --name ${{parameters.aksclusterName}} --resource-group ${{parameters.resourceGroupName}}
            az acr login --name ${{parameters.acrUrl}}
            docker tag "python:latest" '${{parameters.acrUrl}}'"/python:latest"
            docker image ls
            docker push '${{parameters.acrUrl}}'"/python:latest"
